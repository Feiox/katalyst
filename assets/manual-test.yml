listener:
  interface: "0.0.0.0:8000"

hosts:
  httpbin:
    balancer: round_robin
    servers:
      - "http://httpbin.org"

routes:
  - path:
      type: exact
      path: "/"
    downstream:
      host: httpbin
      path: "/ip"

  - path:
      type: regex
      pattern: "^/test/(?P<cap>.*)$"
    methods:
      - get
    downstream:
      host: httpbin
      path: "/get"
      query:
        regex_cap: '{{ http.matched("cap") }}'
        method: "{{ http.method() }}"
        ip: "{{ http.ip() }}"
      headers:
        header: '{{ http.header("user-agent") }}'
        claim: '{{ auth.claim("KatalystAuthenticator") }}'
    authenticators:
      - backend: http
        url: "https://postman-echo.com/get?thing=something"

  - path:
      type: template
      template: "/test/{{http.ip()}}/post"
    methods:
      - post
    downstream:
      host: httpbin
      path: "/post"
